# Marketing Module - Complete Infrastructure

> **Status**: Schema Complete âœ… | Updated: 2026-02-05

## ğŸ¯ Campaign Planning Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CAMPAIGN CREATION                                    â”‚
â”‚  Name, Type, Budget, Goals (Leads/Enrollments/Revenue), ROAS Target         â”‚
â”‚  Attribution Model: First Touch | Last Touch | Linear | Time Decay          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â–¼                        â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ONLINE FUNNEL   â”‚    â”‚  OFFLINE FUNNEL  â”‚    â”‚   PARTNERSHIPS   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Landing Pages  â”‚    â”‚ â€¢ Marketing Eventsâ”‚   â”‚ â€¢ Influencers    â”‚
â”‚ â€¢ A/B Testing    â”‚    â”‚ â€¢ QR Codes        â”‚    â”‚ â€¢ Local Business â”‚
â”‚ â€¢ Meta Ads       â”‚    â”‚ â€¢ Print Materials â”‚    â”‚ â€¢ Schools        â”‚
â”‚ â€¢ Google Ads     â”‚    â”‚ â€¢ Flyering        â”‚    â”‚ â€¢ Commissions    â”‚
â”‚ â€¢ Email/WhatsApp â”‚    â”‚ â€¢ Fairs/Workshops â”‚    â”‚ â€¢ Referral Codes â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                        â”‚                        â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         TRACKING & ATTRIBUTION                               â”‚
â”‚  Visitors â†’ Sessions â†’ Events â†’ QR Scans â†’ Leads â†’ Enrollments              â”‚
â”‚  Multi-touch attribution, UTM tracking, offline-to-online linking           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ANALYTICS & ROAS                                     â”‚
â”‚  Daily metrics, CAC, CPL, CVR, ROAS by campaign/channel/location            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ… Implemented Schema (Complete)

### Core Marketing Tables
| Table | Purpose | Status |
|-------|---------|--------|
| `campaigns` | Campaign planning with ROAS targets, ad platform sync | âœ… Enhanced |
| `campaignLeads` | Lead â†” Campaign attribution | âœ… |
| `campaignDailyMetrics` | Daily ROAS, CAC, CPL, CVR | âœ… New |
| `marketingTargets` | TOFU/MOFU/BOFU goals by period | âœ… New |
| `marketingIntegrations` | Meta, Google, LinkedIn pixels | âœ… New |

### Visitor & Session Tracking
| Table | Purpose | Status |
|-------|---------|--------|
| `visitors` | Anonymous pre-lead tracking, fingerprint | âœ… New |
| `sessions` | Session-level UTM and behavior | âœ… New |
| `trackingEvents` | Page views, clicks, form events | âœ… New |

### Landing Pages & A/B Testing
| Table | Purpose | Status |
|-------|---------|--------|
| `landingPages` | Full page builder with A/B variants | âœ… Enhanced |
| `abTestAssignments` | Visitor â†’ variant assignment | âœ… New |
| `landingPageDailyMetrics` | Aggregated page performance | âœ… New |

### Content Production Pipeline
| Table | Purpose | Status |
|-------|---------|--------|
| `contentTypes` | Define formats (IG Post, Flyer A5, Banner) | âœ… New |
| `contentAssets` | Asset library with approval workflow | âœ… New |
| `contentCalendar` | Production scheduling | âœ… New |

### Offline Marketing (Person-to-Person)
| Table | Purpose | Status |
|-------|---------|--------|
| `marketingEvents` | Open houses, workshops, fairs, flyering | âœ… New |
| `eventRegistrations` | RSVPs, attendance, follow-up | âœ… New |
| `marketingPartners` | Influencers, local businesses | âœ… New |

### QR Code Tracking (Offline â†’ Online Bridge)
| Table | Purpose | Status |
|-------|---------|--------|
| `qrCodes` | Trackable QR codes with location/campaign tags | âœ… New |
| `qrScans` | Individual scan records with conversion tracking | âœ… New |

### Lead Attribution (Enhanced)
| Field | Location | Purpose |
|-------|----------|---------|
| `firstSource/Medium/CampaignId` | `leads` | First touch attribution |
| `lastSource/Medium/CampaignId` | `leads` | Last touch attribution |
| `firstLandingPage/lastLandingPage` | `leads` | Full journey tracking |
| `visitorId` | `leads` | Link to anonymous history |
| `utmSource/Medium/Campaign/Content/Term` | `leads` | Full UTM suite |

---

## ğŸ’¼ Campaign Types Supported

### Digital Campaigns
- **Paid Ads**: Meta (Facebook/Instagram), Google Ads, LinkedIn
- **Organic**: SEO, content marketing
- **Email/WhatsApp**: Sequences, broadcasts
- **Landing Pages**: A/B tested, conversion optimized

### Offline Campaigns
- **Events**: Open houses, workshops, fairs, school visits
- **Flyering**: Street distribution with QR tracking
- **Partnerships**: Local businesses, influencers
- **Print Materials**: Flyers, banners, posters, vehicle wraps

### Hybrid Campaigns
- QR codes link offline materials to online funnels
- Event registrations captured digitally
- Partner referrals tracked with codes

---

## ğŸ“Š Metrics Available

### Campaign-Level
| Metric | Formula |
|--------|---------|
| **CAC** | Total Spend / Enrollments |
| **CPL** | Total Spend / Leads |
| **CVR** | Leads / Visitors Ã— 100 |
| **ROAS** | Revenue / Ad Spend |
| **Goal %** | Actual / Target Ã— 100 |

### Channel-Level
- Visitors, Leads, Enrollments by channel
- Spend by channel
- Attribution breakdown (first/last touch)

### Location-Level (via QR)
- Scans by neighborhood/partner
- Leads by physical location
- Best performing distribution spots

---

## ğŸ”§ Next Steps (Implementation Order)

### Phase 1: Core Tracking (Priority)
- [ ] Implement `/api/track` endpoint for events
- [ ] Create tracking script for school websites
- [ ] Wire up visitor/session creation flow
- [ ] Server-side conversion events (Meta CAPI, GA4)

### Phase 2: QR System
- [ ] Port QR generator from `QR_IMPLEMENTATION_GUIDE.md`
- [ ] Create QR management UI
- [ ] Implement `/api/qr/scan` redirect endpoint
- [ ] QR code dashboard with scan analytics

### Phase 3: Campaign Management UI
- [ ] Campaign creation wizard
- [ ] Content calendar view
- [ ] Event planning & registration
- [ ] Partner management

### Phase 4: Analytics Dashboard
- [ ] Real-time campaign metrics
- [ ] Attribution reports
- [ ] ROAS calculations
- [ ] Goal progress tracking

### Phase 5: Automations
- [ ] Auto-sync with ad platforms
- [ ] Lead scoring based on behavior
- [ ] Trigger-based nurturing
- [ ] Weekly heartbeat reports

---

## ğŸ“‹ API Endpoints Needed

### Tracking
```
POST /api/track                    # Client-side event tracking
POST /api/track/identify           # Link visitor to lead
GET  /api/qr/:code                 # QR redirect with scan tracking
```

### Campaigns
```
GET  /api/{org}/marketing/campaigns
POST /api/{org}/marketing/campaigns
PUT  /api/{org}/marketing/campaigns/:id
POST /api/{org}/marketing/campaigns/:id/sync  # Sync from ad platform
```

### Content
```
GET  /api/{org}/marketing/assets
POST /api/{org}/marketing/assets
PUT  /api/{org}/marketing/assets/:id/approve
GET  /api/{org}/marketing/calendar
```

### Events
```
GET  /api/{org}/marketing/events
POST /api/{org}/marketing/events
POST /api/{org}/marketing/events/:id/register
GET  /api/{org}/marketing/events/:id/attendees
```

### QR Codes
```
GET  /api/{org}/marketing/qr
POST /api/{org}/marketing/qr
GET  /api/{org}/marketing/qr/:id/stats
POST /api/{org}/marketing/qr/:id/regenerate
```

### Partners
```
GET  /api/{org}/marketing/partners
POST /api/{org}/marketing/partners
GET  /api/{org}/marketing/partners/:id/leads
```

### Targets & Analytics
```
GET  /api/{org}/marketing/targets/current
POST /api/{org}/marketing/targets
GET  /api/{org}/marketing/analytics/dashboard
GET  /api/{org}/marketing/analytics/attribution
```

---

## ğŸ¨ UI Pages Needed

| Page | Path | Purpose |
|------|------|---------|
| Marketing Command | `/staff/marketing` | KPI dashboard, quick actions |
| Campaigns | `/staff/marketing/campanhas` | Campaign list & creation |
| Content Library | `/staff/marketing/conteudo` | Assets, calendar |
| Events | `/staff/marketing/eventos` | Event planning |
| QR Codes | `/staff/marketing/qr` | QR management |
| Partners | `/staff/marketing/parcerias` | Partner tracking |
| Analytics | `/staff/marketing/analytics` | Deep dive reports |
| Settings | `/admin/marketing/configuracoes` | Pixels, attribution |

---

*Marketing module schema complete. Ready for API and UI implementation.*
